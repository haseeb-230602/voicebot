<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VoiceBot: Abdul Haseeb Basha</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto; background:#0f172a; color:#e2e8f0; display:flex; align-items:center; justify-content:center; min-height:100vh; }
    .card { background:#111827; border:1px solid #1f2937; border-radius:16px; padding:24px; width:min(720px, 92vw); box-shadow:0 10px 40px rgba(0,0,0,0.4); }
    h1 { margin:0 0 8px; font-size:24px; }
    p { color:#94a3b8; margin:6px 0 16px; }
    .controls { display:flex; gap:12px; align-items:center; margin-bottom:12px; }
    button { background:#22c55e; color:#062a12; border:none; padding:12px 16px; border-radius:12px; font-weight:600; cursor:pointer; }
    button.secondary { background:#3b82f6; color:white; }
    button[disabled] { background:#374151; color:#9ca3af; cursor:not-allowed; }
    .grid { display:flex; gap:8px; flex-wrap:wrap; }
    .log { background:#0b1220; border:1px solid #1f2937; border-radius:12px; padding:12px; height:180px; overflow:auto; font-size:14px; margin-top:12px; }
    .footer { margin-top:12px; font-size:12px; color:#64748b; }
  </style>
</head>
<body>
  <div class="card">
    <h1>VoiceBot — Abdul Haseeb Basha</h1>
    <p>Hold the mic, ask a question, and hear Abdul’s answer.</p>

    <div class="controls">
      <button id="pressToTalk">Hold to talk</button>
      <audio id="audioOut" controls></audio>
    </div>

    <p>Quick tests:</p>
    <div class="grid">
      <button class="secondary" data-q="What should we know about your life story in a few sentences?">Life story</button>
      <button class="secondary" data-q="What’s your #1 superpower?">Superpower</button>
      <button class="secondary" data-q="What are the top 3 areas you’d like to grow in?">Growth areas</button>
      <button class="secondary" data-q="What misconception do your coworkers have about you?">Misconception</button>
      <button class="secondary" data-q="How do you push your boundaries and limits?">Boundaries</button>
    </div>

    <div class="log" id="log"></div>
    <div class="footer">No setup needed. Works in Chrome/Edge and most modern browsers. Mic permission required.</div>
  </div>

<script>
const logEl = document.getElementById('log');
function log(msg){ const div=document.createElement('div'); div.textContent = msg; logEl.appendChild(div); logEl.scrollTop = logEl.scrollHeight; }

const pressBtn = document.getElementById('pressToTalk');
const audioOut = document.getElementById('audioOut');

// STT via Web Speech API (fallback)
let recognizer;
function setupSTT(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){ log('Speech recognition not supported—use the quick buttons.'); return null; }
  const r = new SR();
  r.lang = 'en-US';
  r.interimResults = false;
  r.maxAlternatives = 1;
  return r;
}
recognizer = setupSTT();

async function askText(text){
  log('You: ' + text);
  try {
    const res = await fetch('/api/answer', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ text })
    });
    if(!res.ok){ const err = await res.text(); log('Error: ' + err); return; }
    const data = await res.json();
    const reply = data.text;
    log('Abdul: ' + reply);

    // TTS
    if('speechSynthesis' in window){
      const u = new SpeechSynthesisUtterance(reply);
      u.rate = 1.0; u.pitch = 1.0;
      speechSynthesis.speak(u);
    }
  } catch(e){ log('Network error: ' + String(e)); }
}

document.querySelectorAll('button[data-q]').forEach(b=>{
  b.addEventListener('click', ()=> askText(b.dataset.q));
});

let holding = false;
pressBtn.addEventListener('mousedown', startHold);
pressBtn.addEventListener('touchstart', startHold, {passive:true});
pressBtn.addEventListener('mouseup', endHold);
pressBtn.addEventListener('mouseleave', endHold);
pressBtn.addEventListener('touchend', endHold);

function startHold(){
  if(holding) return;
  holding = true;
  pressBtn.textContent = 'Listening...';
  if(recognizer){
    recognizer.onresult = (evt)=>{
      const text = evt.results[0][0].transcript;
      askText(text);
    };
    recognizer.onerror = (e)=> log('STT error: ' + e.error);
    try { recognizer.start(); } catch(e){}
  } else {
    log('Browser STT unavailable. Use the quick buttons.');
  }
}

function endHold(){
  if(!holding) return;
  holding = false;
  pressBtn.textContent = 'Hold to talk';
  if(recognizer){ try { recognizer.stop(); } catch(e){} }
}
</script>
</body>
</html>
